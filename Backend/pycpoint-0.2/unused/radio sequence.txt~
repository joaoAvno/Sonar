Wireshark file = Radio on fedora desktop controller from start

NOTE - have not included event subscription calls.

GET /xml/zone_player.xml 
    this contains a Rhapsody extension
    
        <X_Rhapsody-Extension xmlns="http://www.real.com/rhapsody/xmlns/upnp-1-0">
            <deviceID>urn:rhapsody-real-com:device-id-1-0:sonos_1:RINCON_000E5823A88A01400          <--- check this line
            </deviceID>
            <deviceCapabilities>
                <interactionPattern type="real-rhapsody-upnp-1-0"/>
            </deviceCapabilities>
        </X_Rhapsody-Extension>

SUBSCRIBE /ZoneGroupTopology/Event 

NOTIFY /notify
    this contains a third party media server service

        <e:propertyset xmlns:e="urn:schemas-upnp-org:event-1-0">
            <e:property>
                <ZoneGroupState>
                    <ZoneGroups>
                        <ZoneGroup Coordinator="RINCON_000E5830D2F001400" ID="RINCON_000E5830D2F001400:1">
                            <ZoneGroupMember UUID="RINCON_000E5830D2F001400" Location="http://192.168.0.10:1400/xml/zone_player.xml" ZoneName="Kitchen" Icon="x-rincon-roomicon:kitchen" SoftwareVersion="11.7-19141" MinCompatibleVersion="10.20-00000" BootSeq="135"/>
                        </ZoneGroup>
                        <ZoneGroup Coordinator="RINCON_000E5823A88A01400" ID="RINCON_000E5823A88A01400:3">
                            <ZoneGroupMember UUID="RINCON_000E5823A88A01400" Location="http://192.168.0.3:1400/xml/zone_player.xml" ZoneName="Living Room" Icon="x-rincon-roomicon:living" SoftwareVersion="11.7-19141" MinCompatibleVersion="10.20-00000" BootSeq="83"/>
                        </ZoneGroup>
                    </ZoneGroups>
                </ZoneGroupState>
            </e:property>
            <e:property>
                <ThirdPartyMediaServers>
                    <MediaServers>
                        <Service UDN="SA_RINCON7_henkelis3" Md="" Password="jackson2"/>
                    </MediaServers>
                </ThirdPartyMediaServers>
            </e:property>
            <e:property>
                <AvailableSoftwareUpdate>
                    <UpdateItem xmlns="urn:schemas-rinconnetworks-com:update-1-0" Type="Software" Version="11.7-19141" UpdateURL="http://update.sonos.com/firmware/Gold/v3.0-Hendrix-GC2_Gold/^11.7-19141" DownloadSize="0"/>
                </AvailableSoftwareUpdate>
            </e:property>
            <e:property>
                <AlarmRunSequence>RINCON_000E5823A88A01400:83:0</AlarmRunSequence>
            </e:property>
        </e:propertyset>

POST /SystemProperties/Control

    This requests R_CustomerID
        <s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/" s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">
            <s:Body>
                <u:GetString xmlns:u="urn:schemas-upnp-org:service:SystemProperties:1">
                    <VariableName>R_CustomerID</VariableName>
                </u:GetString>
            </s:Body>
        </s:Envelope>

        <s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/" s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">
            <s:Body>
            <u:GetStringResponse xmlns:u="urn:schemas-upnp-org:service:SystemProperties:1">
                <StringValue>109485567</StringValue>
            </u:GetStringResponse>
            </s:Body>
        </s:Envelope>

SUBSCRIBE /MediaServer/ContentDirectory/Event

POST /MediaServer/ContentDirectory/Control
SOAPACTION: "urn:schemas-upnp-org:service:ContentDirectory:1#Browse"
    ObjectID = A:ALBUMARTIST
<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/" s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><s:Body><u:Browse xmlns:u="urn:schemas-upnp-org:service:ContentDirectory:1"><ObjectID>A:ALBUMARTIST</ObjectID><BrowseFlag>BrowseDirectChildren</BrowseFlag><Filter>dc:title,res,dc:creator,upnp:artist,upnp:album,upnp:albumArtURI</Filter><StartingIndex>0</StartingIndex><RequestedCount>100</RequestedCount><SortCriteria></SortCriteria></u:Browse></s:Body></s:Envelope>

NOTIFY /notify
    contains update id's
        <e:propertyset xmlns:e="urn:schemas-upnp-org:event-1-0">
            <e:property>
                <SystemUpdateID>4</SystemUpdateID>
            </e:property>
            <e:property>
                <ContainerUpdateIDs>S:,3</ContainerUpdateIDs>
            </e:property>
            <e:property>
                <ShareListRefreshState>NOTRUN</ShareListRefreshState>
            </e:property>
            <e:property>
                <ShareIndexInProgress>0</ShareIndexInProgress>
            </e:property>
            <e:property>
                <ShareIndexLastError></ShareIndexLastError>
            </e:property>
            <e:property>
                <UserRadioUpdateID>RINCON_000E5830D2F001400,6</UserRadioUpdateID>
            </e:property>
            <e:property>
                <SavedQueuesUpdateID>RINCON_000E5830D2F001400,6</SavedQueuesUpdateID>
            </e:property>
            <e:property>
                <ShareListUpdateID>RINCON_000E5823A88A01400,192</ShareListUpdateID>
            </e:property>
            <e:property>
                <RecentlyPlayedUpdateID>RINCON_000E5823A88A01400,0</RecentlyPlayedUpdateID>
            </e:property>
        </e:propertyset>

POST /MediaServer/ContentDirectory/Control
SOAPACTION: "urn:schemas-upnp-org:service:ContentDirectory:1#Browse"
    ObjectID = S:
<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/" s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><s:Body><u:Browse xmlns:u="urn:schemas-upnp-org:service:ContentDirectory:1"><ObjectID>S:</ObjectID><BrowseFlag>BrowseDirectChildren</BrowseFlag><Filter>dc:title,res,dc:creator,upnp:artist,upnp:album,upnp:albumArtURI</Filter><StartingIndex>0</StartingIndex><RequestedCount>100</RequestedCount><SortCriteria></SortCriteria></u:Browse></s:Body></s:Envelope>

Get other zone player XML

Browse for Q:0

Notify for other ZP
        <SystemUpdateID>2</SystemUpdateID>
        <ContainerUpdateIDs>S:,1</ContainerUpdateIDs>
        <ShareListRefreshState>NOTRUN</ShareListRefreshState>
        <ShareIndexInProgress>0</ShareIndexInProgress>
        <ShareIndexLastError></ShareIndexLastError>
        <UserRadioUpdateID>RINCON_000E5830D2F001400,6</UserRadioUpdateID>
        <SavedQueuesUpdateID>RINCON_000E5830D2F001400,6</SavedQueuesUpdateID>
        <ShareListUpdateID>RINCON_000E5823A88A01400,192</ShareListUpdateID>
        <RecentlyPlayedUpdateID>RINCON_000E5823A88A01400,0</RecentlyPlayedUpdateID>

POST /MusicServices/Control
    <s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/" s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">
        <s:Body>
            <u:ListAvailableServicesResponse xmlns:u="urn:schemas-upnp-org:service:MusicServices:1">
                <AvailableServiceDescriptorList>
                <Services>
                    <Service Id="0" Name="Napster" Version="1.0" Uri="http://api.napster.com/device/soap/v1" SecureUri="https://api.napster.com/device/soap/v1" Capabilities="31" MaxMessagingChars="0">
                        <Policy Auth="UserId" PollInterval="30"/>
                        <Presentation>
                            <Strings Version="1" Uri="http://update-services.sonos.com/services/napster/string.xml"/>
                            <Logos Small="http://www.napster.com/services/Sonos/SmallLogo.png" Large="http://www.napster.com/services/Sonos/LargeLogo.png"/>
                        </Presentation>
                    </Service>
                    <Service Id="254" Name="RadioTime" Version="1.1" Uri="http://legato.radiotime.com/Radio.asmx" SecureUri="http://legato.radiotime.com/Radio.asmx" Capabilities="0" MaxMessagingChars="0">
                        <Policy Auth="Anonymous" PollInterval="0"/>
                        <Presentation>
                        </Presentation>
                    </Service>
                    <Service Id="2" Name="Deezer" Version="1.1" Uri="http://moapi.sonos.com/Deezer/SonosAPI.php" SecureUri="https://moapi.sonos.com/Deezer/SonosAPI.php" Capabilities="19" MaxMessagingChars="0">
                        <Policy Auth="UserId" PollInterval="60"/>
                        <Presentation>
                        </Presentation>
                    </Service>
                </Services>
                </AvailableServiceDescriptorList>
                <AvailableServiceTypeList>7,11,519,775</AvailableServiceTypeList>
                <AvailableServiceListVersion>RINCON_000E5823A88A01400:247</AvailableServiceListVersion>
            </u:ListAvailableServicesResponse>
        </s:Body>
    </s:Envelope>

NOTIFY /notify

POST /SystemProperties/Control
SOAPACTION: "urn:schemas-upnp-org:service:SystemProperties:1#GetString"
    R_UpdatePreference
        <s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/" s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><s:Body><u:GetString xmlns:u="urn:schemas-upnp-org:service:SystemProperties:1"><VariableName>R_UpdatePreference</VariableName></u:GetString></s:Body></s:Envelope>
        <s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/" s:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"><s:Body><u:GetStringResponse xmlns:u="urn:schemas-upnp-org:service:SystemProperties:1"><StringValue>all</StringValue></u:GetStringResponse></s:Body></s:Envelope>

Browse for S:

Get R_CustomerID (109485567)

Browse for A:ALBUMARTIST

POST /ZoneGroupTopology/Control
SOAPACTION: "urn:schemas-upnp-org:service:ZoneGroupTopology:1#CheckForUpdate"

Browse for A:ALBUMARTIST

GET /getaa?s=1&u=x-sonosapi-stream%3as58710%3fsid%3d254%26flags%3d32

POST /SystemProperties/Control
SOAPACTION: "urn:schemas-upnp-org:service:SystemProperties:1#GetString"
    R_PromoVersion
    11.7-19141

    R_CustomerID
    109485567

    R_PromoVersion
    11.7-19141

Then it gets some form of certificate

POST /SystemProperties/Control
SOAPACTION: "urn:schemas-upnp-org:service:SystemProperties:1#DoPostUpdateTasks"

GetString
    R_ForceReIndex
    10.19-70280a
    
    R_RadioLocation
    F00080000r100781,Manchester-Liverpool
    
Radio getMetadata for root

Radio getMetadata for search

Radio getLastUpdate

Radio getMetadata for r0

Radio getMetadata for r101320




